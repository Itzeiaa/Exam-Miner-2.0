<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Gemini Image Describe (No Install)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 24px; }
    .row { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; }
    label { font-weight: 600; }
    input[type="file"] { padding: 8px 0; }
    button { padding: 10px 14px; border: 0; border-radius: 8px; cursor: pointer; }
    #run { background: #111827; color: #fff; }
    #run:disabled { opacity: 0.6; cursor: not-allowed; }
    #preview { max-width: 320px; max-height: 240px; border: 1px solid #ddd; border-radius: 8px; object-fit: contain; }
    textarea { width: 100%; min-height: 180px; padding: 12px; border-radius: 8px; border: 1px solid #ddd; }
    .hint { color: #6b7280; font-size: 0.9em; }
  </style>
</head>
<body>
  <h1>Gemini Image Describe (Browser demo)</h1>

  <div class="row" style="margin-bottom:12px;">
    <label for="key">API Key:</label>
    <input id="key" type="password" placeholder="Paste your GEMINI API key" style="min-width:320px;padding:8px;border:1px solid #ddd;border-radius:8px;">
  </div>

  <div class="row" style="margin-bottom:12px;">
    <input id="file" type="file" accept="image/*">
    <button id="run" disabled>Describe image</button>
    <span class="hint">Upload an image, then click “Describe image”.</span>
  </div>

  <div class="row" style="margin-bottom:16px;">
    <img id="preview" alt="Preview will appear here">
  </div>

  <label for="output">Output</label>
  <textarea id="output" placeholder="Model response will appear here..."></textarea>

  <p class="hint">
    For production, call Gemini from your server (hide the API key) and send only the image from the browser.
  </p>

  <script type="module">
    import { GoogleGenAI } from "https://esm.run/@google/genai";

    const keyEl = document.getElementById('key');
    const fileEl = document.getElementById('file');
    const runBtn = document.getElementById('run');
    const outEl = document.getElementById('output');
    const previewEl = document.getElementById('preview');

    let fileBlob = null;

    fileEl.addEventListener('change', () => {
      const f = fileEl.files?.[0];
      fileBlob = f || null;
      runBtn.disabled = !(keyEl.value && fileBlob);
      outEl.value = '';
      if (f) {
        const url = URL.createObjectURL(f);
        previewEl.src = url;
        previewEl.style.display = 'block';
      } else {
        previewEl.removeAttribute('src');
      }
    });

    keyEl.addEventListener('input', () => {
      runBtn.disabled = !(keyEl.value && fileBlob);
    });

    function readAsDataURL(file) {
      return new Promise((resolve, reject) => {
        const fr = new FileReader();
        fr.onload = () => resolve(fr.result);
        fr.onerror = reject;
        fr.readAsDataURL(file);
      });
    }

    runBtn.addEventListener('click', async () => {
      const apiKey = keyEl.value.trim();
      if (!apiKey) { alert("Please paste your API key."); return; }
      if (!fileBlob) { alert("Please choose an image."); return; }

      runBtn.disabled = true;
      runBtn.textContent = "Analyzing...";
      outEl.value = "Working...";

      try {
        // Convert the file to base64 via data URL
        const dataURL = await readAsDataURL(fileBlob); // e.g. "data:image/jpeg;base64,AAAA..."
        const [meta, b64] = String(dataURL).split(";base64,");
        const mime = meta.replace("data:", "") || (fileBlob.type || "image/jpeg");

        const ai = new GoogleGenAI({ apiKey });

        const res = await ai.models.generateContent({
          model: "gemini-2.5-flash",
          contents: [
            { inlineData: { mimeType: mime, data: b64 } },
            { text: "Describe this image in 3–5 concise bullet points. Then give 5 short tags. if its a person, describe who is it." }
          ]
        });

        // Some SDK versions return {text()} helper; others return candidates.
        const text =
          typeof res.text === "function"
            ? await res.text()
            : (res.output_text || res.candidates?.[0]?.content?.parts?.map(p => p.text).join("\n") || JSON.stringify(res, null, 2));

        outEl.value = text;
      } catch (err) {
        console.error(err);
        outEl.value = "Error: " + (err?.message || err);
      } finally {
        runBtn.textContent = "Describe image";
        runBtn.disabled = false;
      }
    });
  </script>
</body>
</html>